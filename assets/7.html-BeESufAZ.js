import{_ as a,c as n,e as s,o as t}from"./app-BmNdzpCo.js";const r={};function l(p,e){return t(),n("div",null,[...e[0]||(e[0]=[s('<h1 id="转载声明" tabindex="-1"><a class="header-anchor" href="#转载声明"><span>转载声明</span></a></h1><p>本文转自 <a href="https://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank" rel="noopener noreferrer">https://lotabout.me/2016/write-a-C-interpreter-7/</a>，如有侵权，请联系删除。</p><h1 id="原文内容" tabindex="-1"><a class="header-anchor" href="#原文内容"><span>原文内容</span></a></h1><h1 id="手把手教你构建-c-语言编译器-7-语句" tabindex="-1"><a class="header-anchor" href="#手把手教你构建-c-语言编译器-7-语句"><span>手把手教你构建 C 语言编译器（7）- 语句</span></a></h1><p>Table of Contents</p><ol><li><a href="about:blank#%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">1. 语句</a><ol><li><a href="about:blank#if-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">1.1. IF 语句</a></li><li><a href="about:blank#while-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">1.2. While 语句</a></li><li><a href="about:blank#return-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">1.3. Return 语句</a></li><li><a href="about:blank#%E5%85%B6%E5%AE%83%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer">1.4. 其它语句</a></li></ol></li><li><a href="about:blank#%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener noreferrer">2. 代码</a></li><li><a href="about:blank#%E5%B0%8F%E7%BB%93" target="_blank" rel="noopener noreferrer">3. 小结</a></li></ol><p>整个编译器还剩下最后两个部分：语句和表达式的解析。它们的内容比较多，主要涉及如何将语句和表达式编译成汇编代码。这章讲解语句的解析，相对于表达式来说它还是较为容易的。</p><p>手把手教你构建 C 语言编译器系列共有10个部分：</p><ol><li><a href="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（0）——前言</a></li><li><a href="http://lotabout.me/2015/write-a-C-interpreter-1/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（1）——设计</a></li><li><a href="http://lotabout.me/2015/write-a-C-interpreter-2/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（2）——虚拟机</a></li><li><a href="http://lotabout.me/2015/write-a-C-interpreter-3/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（3）——词法分析器</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-4/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（4）——递归下降</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-5/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（5）——变量定义</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-6/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（6）——函数定义</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（7）——语句</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-8/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（8）——表达式</a></li><li><a href="http://lotabout.me/2016/write-a-C-interpreter-9/" target="_blank" rel="noopener noreferrer">手把手教你构建 C 语言编译器（9）——总结</a></li></ol><h2 id="语句" tabindex="-1"><a class="header-anchor" href="#语句"><span><a href="about:blank#%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer"></a>语句</span></a></h2><p>C 语言区分“语句”（statement）和“表达式”（expression）两个概念。简单地说，可以认为语句就是表达式加上末尾的分号。</p><p>在我们的编译器中共识别 6 种语句：</p><ol><li><code>if (...) &lt;statement&gt; [else &lt;statement&gt;]</code></li><li><code>while (...) &lt;statement&gt;</code></li><li><code>{ &lt;statement&gt; }</code></li><li><code>return xxx;</code></li><li><code>&lt;empty statement&gt;</code>;</li><li><code>expression;</code> (expression end with semicolon)</li></ol><p>它们的语法分析都相对容易，重要的是去理解如何将这些语句编译成汇编代码，下面我们逐一解释。</p><h3 id="if-语句" tabindex="-1"><a class="header-anchor" href="#if-语句"><span><a href="about:blank#if-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer"></a>IF 语句</span></a></h3><p>IF 语句的作用是跳转，跟据条件表达式决定跳转的位置。我们看看下面的伪代码：</p><table><tbody><tr><td class="code"><pre><span class="line">if (...) &lt;statement&gt; [else &lt;statement&gt;]</span><br><span class="line"></span><br><span class="line">  if (&lt;cond&gt;)                   &lt;cond&gt;</span><br><span class="line">                                JZ a</span><br><span class="line">    &lt;true_statement&gt;   ===&gt;     &lt;true_statement&gt;</span><br><span class="line">  else:                         JMP b</span><br><span class="line">a:                           a:</span><br><span class="line">    &lt;false_statement&gt;           &lt;false_statement&gt;</span><br><span class="line">b:                           b:</span><br></pre></td></tr></tbody></table><p>对应的汇编代码流程为：</p><ol><li>执行条件表达式 <code>&lt;cond&gt;</code>。</li><li>如果条件失败，则跳转到 <code>a</code> 的位置，执行 <code>else</code> 语句。这里 <code>else</code> 语句是可以省略的，此时 <code>a</code> 和 <code>b</code> 都指向 IF 语句后方的代码。</li><li>因为汇编代码是顺序排列的，所以如果执行了 <code>true_statement</code>，为了防止因为顺序排列而执行了 <code>false_statement</code>，所以需要无条件跳转 <code>JMP b</code>。</li></ol><p>对应的 C 代码如下：</p><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (token == If) {</span><br><span class="line">    match(If);</span><br><span class="line">    match(<span class="string">&#39;(&#39;</span>);</span><br><span class="line">    expression(Assign);  <span class="comment">// parse condition</span></span><br><span class="line">    match(<span class="string">&#39;)&#39;</span>);</span><br><span class="line"></span><br><span class="line">    *++text = JZ;</span><br><span class="line">    b = ++text;</span><br><span class="line"></span><br><span class="line">    statement();         <span class="comment">// parse statement</span></span><br><span class="line">    <span class="keyword">if</span> (token == Else) { <span class="comment">// parse else</span></span><br><span class="line">        match(Else);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// emit code for JMP B</span></span><br><span class="line">        *b = (<span class="type">int</span>)(text + <span class="number">3</span>);</span><br><span class="line">        *++text = JMP;</span><br><span class="line">        b = ++text;</span><br><span class="line"></span><br><span class="line">        statement();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    *b = (<span class="type">int</span>)(text + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table><h3 id="while-语句" tabindex="-1"><a class="header-anchor" href="#while-语句"><span><a href="about:blank#while-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer"></a>While 语句</span></a></h3><p>While 语句比 If 语句简单，它对应的汇编代码如下：</p><table><tbody><tr><td class="code"><pre><span class="line">a:                     a:</span><br><span class="line">   while (&lt;cond&gt;)        &lt;cond&gt;</span><br><span class="line">                         JZ b</span><br><span class="line">    &lt;statement&gt;          &lt;statement&gt;</span><br><span class="line">                         JMP a</span><br><span class="line">b:                     b:</span><br></pre></td></tr></tbody></table><p>没有什么值得说明的内容，它的 C 代码如下：</p><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (token == While) {</span><br><span class="line">    match(While);</span><br><span class="line"></span><br><span class="line">    a = text + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    match(<span class="string">&#39;(&#39;</span>);</span><br><span class="line">    expression(Assign);</span><br><span class="line">    match(<span class="string">&#39;)&#39;</span>);</span><br><span class="line"></span><br><span class="line">    *++text = JZ;</span><br><span class="line">    b = ++text;</span><br><span class="line"></span><br><span class="line">    statement();</span><br><span class="line"></span><br><span class="line">    *++text = JMP;</span><br><span class="line">    *++text = (<span class="type">int</span>)a;</span><br><span class="line">    *b = (<span class="type">int</span>)(text + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table><h3 id="return-语句" tabindex="-1"><a class="header-anchor" href="#return-语句"><span><a href="about:blank#return-%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer"></a>Return 语句</span></a></h3><p>Return 唯一特殊的地方是：一旦遇到了 Return 语句，则意味着函数要退出了，所以需要生成汇编代码 <code>LEV</code> 来表示退出。</p><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (token == Return) {</span><br><span class="line">    <span class="comment">// return [expression];</span></span><br><span class="line">    match(Return);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token != <span class="string">&#39;;&#39;</span>) {</span><br><span class="line">        expression(Assign);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    match(<span class="string">&#39;;&#39;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emit code for return</span></span><br><span class="line">    *++text = LEV;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table><h3 id="其它语句" tabindex="-1"><a class="header-anchor" href="#其它语句"><span><a href="about:blank#%E5%85%B6%E5%AE%83%E8%AF%AD%E5%8F%A5" target="_blank" rel="noopener noreferrer"></a>其它语句</span></a></h3><p>其它语句并不直接生成汇编代码，所以不多做说明，代码如下：</p><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (token == <span class="string">&#39;{&#39;</span>) {</span><br><span class="line">    <span class="comment">// { &lt;statement&gt; ... }</span></span><br><span class="line">    match(<span class="string">&#39;{&#39;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (token != <span class="string">&#39;}&#39;</span>) {</span><br><span class="line">        statement();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    match(<span class="string">&#39;}&#39;</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (token == <span class="string">&#39;;&#39;</span>) {</span><br><span class="line">    <span class="comment">// empty statement</span></span><br><span class="line">    match(<span class="string">&#39;;&#39;</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// a = b; or function_call();</span></span><br><span class="line">    expression(Assign);</span><br><span class="line">    match(<span class="string">&#39;;&#39;</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table><h2 id="代码" tabindex="-1"><a class="header-anchor" href="#代码"><span><a href="about:blank#%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener noreferrer"></a>代码</span></a></h2><p>本章的代码可以在 <a href="https://github.com/lotabout/write-a-C-interpreter/tree/step-5" target="_blank" rel="noopener noreferrer">Github</a> 上下载，也可以直接 clone</p><table><tbody><tr><td class="code"><pre><span class="line">git clone -b step-5 https://github.com/lotabout/write-a-C-interpreter</span><br></pre></td></tr></tbody></table><p>本章的代码依旧无法运行，还剩最后一部分没有完成：<code>expression</code>。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span><a href="about:blank#%E5%B0%8F%E7%BB%93" target="_blank" rel="noopener noreferrer"></a>小结</span></a></h2><p>本章讲解了如何将语句编译成汇编代码，内容相对容易一些，关键就是去理解汇编代码的执行原理。</p><p>同时值得一提的是，编译器的语法分析部分其实是很简单的，而真正的难点是如何在语法分析时收集足够多的信息，最终把源代码转换成目标代码（汇编）。我认为这也是初学者实现编译器的一大难点，往往比词法分析/语法分析更困难。</p><p>所以建议如果没有学过汇编，可以学习学习，它本身不难，但对理解计算机的原理有很大帮助。</p>',40)])])}const i=a(r,[["render",l]]),c=JSON.parse('{"path":"/tech/designASimpileCCompiler/7.html","title":"手把手教你构建 C 语言编译器（7）——语句","lang":"en-US","frontmatter":{"title":"手把手教你构建 C 语言编译器（7）——语句","category":["编译原理"],"tag":["c","编译器","解释器"],"description":"转载声明 本文转自 https://lotabout.me/2016/write-a-C-interpreter-7/，如有侵权，请联系删除。 原文内容 手把手教你构建 C 语言编译器（7）- 语句 Table of Contents 1. 语句 1.1. IF 语句 1.2. While 语句 1.3. Return 语句 1.4. 其它语句 2. ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"手把手教你构建 C 语言编译器（7）——语句\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-31T15:01:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"KSJ\\",\\"url\\":\\"https://github.com/King-sj\\"}]}"],["meta",{"property":"og:url","content":"https://github.com/King-sj/tech/designASimpileCCompiler/7.html"}],["meta",{"property":"og:site_name","content":"kblog"}],["meta",{"property":"og:title","content":"手把手教你构建 C 语言编译器（7）——语句"}],["meta",{"property":"og:description","content":"转载声明 本文转自 https://lotabout.me/2016/write-a-C-interpreter-7/，如有侵权，请联系删除。 原文内容 手把手教你构建 C 语言编译器（7）- 语句 Table of Contents 1. 语句 1.1. IF 语句 1.2. While 语句 1.3. Return 语句 1.4. 其它语句 2. ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-31T15:01:46.000Z"}],["meta",{"property":"article:tag","content":"解释器"}],["meta",{"property":"article:tag","content":"编译器"}],["meta",{"property":"article:tag","content":"c"}],["meta",{"property":"article:modified_time","content":"2025-12-31T15:01:46.000Z"}]]},"git":{"createdTime":1767193306000,"updatedTime":1767193306000,"contributors":[{"name":"king-sj","username":"king-sj","email":"2175616761@qq.com","commits":1,"url":"https://github.com/king-sj"}]},"readingTime":{"minutes":6.99,"words":2097},"filePathRelative":"tech/designASimpileCCompiler/7.md","excerpt":"\\n<p>本文转自 <a href=\\"https://lotabout.me/2016/write-a-C-interpreter-7/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://lotabout.me/2016/write-a-C-interpreter-7/</a>，如有侵权，请联系删除。</p>\\n<h1>原文内容</h1>\\n<h1>手把手教你构建 C 语言编译器（7）- 语句</h1>\\n<p>Table of Contents</p>\\n<ol>\\n<li><a href=\\"about:blank#%E8%AF%AD%E5%8F%A5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1. 语句</a>\\n<ol>\\n<li><a href=\\"about:blank#if-%E8%AF%AD%E5%8F%A5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1.1. IF 语句</a></li>\\n<li><a href=\\"about:blank#while-%E8%AF%AD%E5%8F%A5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1.2. While 语句</a></li>\\n<li><a href=\\"about:blank#return-%E8%AF%AD%E5%8F%A5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1.3. Return 语句</a></li>\\n<li><a href=\\"about:blank#%E5%85%B6%E5%AE%83%E8%AF%AD%E5%8F%A5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1.4. 其它语句</a></li>\\n</ol>\\n</li>\\n<li><a href=\\"about:blank#%E4%BB%A3%E7%A0%81\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">2. 代码</a></li>\\n<li><a href=\\"about:blank#%E5%B0%8F%E7%BB%93\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">3. 小结</a></li>\\n</ol>","autoDesc":true}');export{i as comp,c as data};
