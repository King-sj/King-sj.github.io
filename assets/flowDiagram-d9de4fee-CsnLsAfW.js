import{j as C,X as vt}from"./flowDb-5aa2917a-DaW1R2Pa.js";import{L as j,e as D,T as x,M as mt,D as W,A as U,b as $,c as J,d as K,z as Z}from"./mermaid.esm.min-1vb70udP.js";import{Y as kt}from"./graph-80608c14-C3J_ReZc.js";import{W as St,j as _t,n as Lt,P as B,k as Ot}from"./layout-0254eb32-CJwAic8i.js";import{h as At,w as Mt,Z as Tt,e as A,t as tt,f as et,b as rt,u as L,p as at}from"./styles-f321baca-BK-ap-Ld.js";import{P as It}from"./line-0c78f995-C0d7ygkH.js";import"./app-Bi-vtw0j.js";import"./index-0cdc3891-vRzZouEA.js";import"./clone-2c3335c5-BW1J9zea.js";import"./edges-20fff4f5-qYz4PaQU.js";import"./createText-9372f704-DOjVM_X2.js";import"./channel-d3ce1aa3-Bmw_FMed.js";import"./array-2ff2c7a6-C3YJfAyO.js";import"./path-428ebac9-B0oSrkCJ.js";function Pt(r){if(!r.ok)throw new Error(r.status+" "+r.statusText);return r.text()}function Nt(r,e){return fetch(r,e).then(Pt)}function Bt(r){return(e,t)=>Nt(e,t).then(a=>new DOMParser().parseFromString(a,r))}var Et=Bt("image/svg+xml"),R={normal:Dt,vee:$t,undirected:Ct};function jt(r){R=r}function Dt(r,e,t,a){var n=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=n.append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");A(i,t[a+"Style"]),t[a+"Class"]&&i.attr("class",t[a+"Class"])}function $t(r,e,t,a){var n=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=n.append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");A(i,t[a+"Style"]),t[a+"Class"]&&i.attr("class",t[a+"Class"])}function Ct(r,e,t,a){var n=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=n.append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");A(i,t[a+"Style"]),t[a+"Class"]&&i.attr("class",t[a+"Class"])}function Ut(r,e){var t=r;return t.node().appendChild(e.label),A(t,e.labelStyle),t}function Wt(r,e){for(var t=r.append("text"),a=Rt(e.label).split(`
`),n=0;n<a.length;n++)t.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(a[n]);return A(t,e.labelStyle),t}function Rt(r){for(var e="",t=!1,a,n=0;n<r.length;++n)if(a=r[n],t){switch(a){case"n":e+=`
`;break;default:e+=a}t=!1}else a==="\\"?t=!0:e+=a;return e}function H(r,e,t){var a=e.label,n=r.append("g");e.labelType==="svg"?Ut(n,e):typeof a!="string"||e.labelType==="html"?tt(n,e):Wt(n,e);var i=n.node().getBBox(),o;switch(t){case"top":o=-e.height/2;break;case"bottom":o=e.height/2-i.height;break;default:o=-i.height/2}return n.attr("transform","translate("+-i.width/2+","+o+")"),n}var z=function(r,e){var t=e.nodes().filter(function(i){return et(e,i)}),a=r.selectAll("g.cluster").data(t,function(i){return i});L(a.exit(),e).style("opacity",0).remove();var n=a.enter().append("g").attr("class","cluster").attr("id",function(i){var o=e.node(i);return o.id}).style("opacity",0).each(function(i){var o=e.node(i),s=x(this);x(this).append("rect");var d=s.append("g").attr("class","label");H(d,o,o.clusterLabelPos)});return a=a.merge(n),a=L(a,e).style("opacity",1),a.selectAll("rect").each(function(i){var o=e.node(i),s=x(this);A(s,o.style)}),a};function zt(r){z=r}let Y=function(r,e){var t=r.selectAll("g.edgeLabel").data(e.edges(),function(n){return at(n)}).classed("update",!0);t.exit().remove(),t.enter().append("g").classed("edgeLabel",!0).style("opacity",0),t=r.selectAll("g.edgeLabel"),t.each(function(n){var i=x(this);i.select(".label").remove();var o=e.edge(n),s=H(i,e.edge(n),0).classed("label",!0),d=s.node().getBBox();o.labelId&&s.attr("id",o.labelId),Object.prototype.hasOwnProperty.call(o,"width")||(o.width=d.width),Object.prototype.hasOwnProperty.call(o,"height")||(o.height=d.height)});var a;return t.exit?a=t.exit():a=t.selectAll(null),L(a,e).style("opacity",0).remove(),t};function Yt(r){Y=r}function F(r,e){return r.intersect(e)}var q=function(r,e,t){var a=r.selectAll("g.edgePath").data(e.edges(),function(o){return at(o)}).classed("update",!0),n=Gt(a,e);Ft(a,e);var i=a.merge!==void 0?a.merge(n):a;return L(i,e).style("opacity",1),i.each(function(o){var s=x(this),d=e.edge(o);d.elem=this,d.id&&s.attr("id",d.id),rt(s,d.class,(s.classed("update")?"update ":"")+"edgePath")}),i.selectAll("path.path").each(function(o){var s=e.edge(o);s.arrowheadId=Lt("arrowhead");var d=x(this).attr("marker-end",function(){return"url("+Xt(location.href,s.arrowheadId)+")"}).style("fill","none");L(d,e).attr("d",function(u){return Vt(e,u)}),A(d,s.style)}),i.selectAll("defs *").remove(),i.selectAll("defs").each(function(o){var s=e.edge(o),d=t[s.arrowhead];d(x(this),s.arrowheadId,s,"arrowhead")}),i};function qt(r){q=r}function Xt(r,e){var t=r.split("#")[0];return t+"#"+e}function Vt(r,e){var t=r.edge(e),a=r.node(e.v),n=r.node(e.w),i=t.points.slice(1,t.points.length-1);return i.unshift(F(a,i[0])),i.push(F(n,i[i.length-1])),nt(t,i)}function nt(r,e){var t=(It||Et.line)().x(function(a){return a.x}).y(function(a){return a.y});return(t.curve||t.interpolate)(r.curve),t(e)}function Ht(r){var e=r.getBBox(),t=r.ownerSVGElement.getScreenCTM().inverse().multiply(r.getScreenCTM()).translate(e.width/2,e.height/2);return{x:t.e,y:t.f}}function Gt(r,e){var t=r.enter().append("g").attr("class","edgePath").style("opacity",0);return t.append("path").attr("class","path").attr("d",function(a){var n=e.edge(a),i=e.node(a.v).elem,o=Ot(n.points.length).map(function(){return Ht(i)});return nt(n,o)}),t.append("defs"),t}function Ft(r,e){var t=r.exit();L(t,e).style("opacity",0).remove()}var X=function(r,e,t){var a=e.nodes().filter(function(o){return!et(e,o)}),n=r.selectAll("g.node").data(a,function(o){return o}).classed("update",!0);n.exit().remove(),n.enter().append("g").attr("class","node").style("opacity",0),n=r.selectAll("g.node"),n.each(function(o){var s=e.node(o),d=x(this);rt(d,s.class,(d.classed("update")?"update ":"")+"node"),d.select("g.label").remove();var u=d.append("g").attr("class","label"),l=H(u,s),g=t[s.shape],c=_t(l.node().getBBox(),"width","height");s.elem=this,s.id&&d.attr("id",s.id),s.labelId&&u.attr("id",s.labelId),Object.prototype.hasOwnProperty.call(s,"width")&&(c.width=s.width),Object.prototype.hasOwnProperty.call(s,"height")&&(c.height=s.height),c.width+=s.paddingLeft+s.paddingRight,c.height+=s.paddingTop+s.paddingBottom,u.attr("transform","translate("+(s.paddingLeft-s.paddingRight)/2+","+(s.paddingTop-s.paddingBottom)/2+")");var h=x(this);h.select(".label-container").remove();var f=g(h,c,s).classed("label-container",!0);A(f,s.style);var b=f.node().getBBox();s.width=b.width,s.height=b.height});var i;return n.exit?i=n.exit():i=n.selectAll(null),L(i,e).style("opacity",0).remove(),n};function Qt(r){X=r}function Jt(r,e){var t=r.filter(function(){return!x(this).classed("update")});function a(n){var i=e.node(n);return"translate("+i.x+","+i.y+")"}t.attr("transform",a),L(r,e).style("opacity",1).attr("transform",a),L(t.selectAll("rect"),e).attr("width",function(n){return e.node(n).width}).attr("height",function(n){return e.node(n).height}).attr("x",function(n){var i=e.node(n);return-i.width/2}).attr("y",function(n){var i=e.node(n);return-i.height/2})}function Kt(r,e){var t=r.filter(function(){return!x(this).classed("update")});function a(n){var i=e.edge(n);return Object.prototype.hasOwnProperty.call(i,"x")?"translate("+i.x+","+i.y+")":""}t.attr("transform",a),L(r,e).style("opacity",1).attr("transform",a)}function Zt(r,e){var t=r.filter(function(){return!x(this).classed("update")});function a(n){var i=e.node(n);return"translate("+i.x+","+i.y+")"}t.attr("transform",a),L(r,e).style("opacity",1).attr("transform",a)}function it(r,e,t,a){var n=r.x,i=r.y,o=n-a.x,s=i-a.y,d=Math.sqrt(e*e*s*s+t*t*o*o),u=Math.abs(e*t*o/d);a.x<n&&(u=-u);var l=Math.abs(e*t*s/d);return a.y<i&&(l=-l),{x:n+u,y:i+l}}function te(r,e,t){return it(r,e,e,t)}function ee(r,e,t,a){var n,i,o,s,d,u,l,g,c,h,f,b,p,w,k;if(n=e.y-r.y,o=r.x-e.x,d=e.x*r.y-r.x*e.y,c=n*t.x+o*t.y+d,h=n*a.x+o*a.y+d,!(c!==0&&h!==0&&Q(c,h))&&(i=a.y-t.y,s=t.x-a.x,u=a.x*t.y-t.x*a.y,l=i*r.x+s*r.y+u,g=i*e.x+s*e.y+u,!(l!==0&&g!==0&&Q(l,g))&&(f=n*s-i*o,f!==0)))return b=Math.abs(f/2),p=o*u-s*d,w=p<0?(p-b)/f:(p+b)/f,p=i*d-n*u,k=p<0?(p-b)/f:(p+b)/f,{x:w,y:k}}function Q(r,e){return r*e>0}function O(r,e,t){var a=r.x,n=r.y,i=[],o=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(function(f){o=Math.min(o,f.x),s=Math.min(s,f.y)});for(var d=a-r.width/2-o,u=n-r.height/2-s,l=0;l<e.length;l++){var g=e[l],c=e[l<e.length-1?l+1:0],h=ee(r,t,{x:d+g.x,y:u+g.y},{x:d+c.x,y:u+c.y});h&&i.push(h)}return i.length?(i.length>1&&i.sort(function(f,b){var p=f.x-t.x,w=f.y-t.y,k=Math.sqrt(p*p+w*w),T=b.x-t.x,S=b.y-t.y,y=Math.sqrt(T*T+S*S);return k<y?-1:k===y?0:1}),i[0]):(console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",r),r)}function G(r,e){var t=r.x,a=r.y,n=e.x-t,i=e.y-a,o=r.width/2,s=r.height/2,d,u;return Math.abs(i)*o>Math.abs(n)*s?(i<0&&(s=-s),d=i===0?0:s*n/i,u=s):(n<0&&(o=-o),d=o,u=n===0?0:o*i/n),{x:t+d,y:a+u}}var V={rect:ae,ellipse:ne,circle:ie,diamond:oe};function re(r){V=r}function ae(r,e,t){var a=r.insert("rect",":first-child").attr("rx",t.rx).attr("ry",t.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height);return t.intersect=function(n){return G(t,n)},a}function ne(r,e,t){var a=e.width/2,n=e.height/2,i=r.insert("ellipse",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("rx",a).attr("ry",n);return t.intersect=function(o){return it(t,a,n,o)},i}function ie(r,e,t){var a=Math.max(e.width,e.height)/2,n=r.insert("circle",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("r",a);return t.intersect=function(i){return te(t,a,i)},n}function oe(r,e,t){var a=e.width*Math.SQRT2/2,n=e.height*Math.SQRT2/2,i=[{x:0,y:-n},{x:-a,y:0},{x:0,y:n},{x:a,y:0}],o=r.insert("polygon",":first-child").attr("points",i.map(function(s){return s.x+","+s.y}).join(" "));return t.intersect=function(s){return O(t,i,s)},o}function se(){var r=function(e,t){ce(t);var a=E(e,"output"),n=E(a,"clusters"),i=E(a,"edgePaths"),o=Y(E(a,"edgeLabels"),t),s=X(E(a,"nodes"),t,V);St(t),Zt(s,t),Kt(o,t),q(i,t,R);var d=z(n,t);Jt(d,t),he(t)};return r.createNodes=function(e){return arguments.length?(Qt(e),r):X},r.createClusters=function(e){return arguments.length?(zt(e),r):z},r.createEdgeLabels=function(e){return arguments.length?(Yt(e),r):Y},r.createEdgePaths=function(e){return arguments.length?(qt(e),r):q},r.shapes=function(e){return arguments.length?(re(e),r):V},r.arrows=function(e){return arguments.length?(jt(e),r):R},r}var le={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"},de={arrowhead:"normal",curve:$};function ce(r){r.nodes().forEach(e=>{const t=r.node(e);!Object.prototype.hasOwnProperty.call(t,"label")&&!r.children(e).length&&(t.label=e),Object.prototype.hasOwnProperty.call(t,"paddingX")&&B(t,{paddingLeft:t.paddingX,paddingRight:t.paddingX}),Object.prototype.hasOwnProperty.call(t,"paddingY")&&B(t,{paddingTop:t.paddingY,paddingBottom:t.paddingY}),Object.prototype.hasOwnProperty.call(t,"padding")&&B(t,{paddingLeft:t.padding,paddingRight:t.padding,paddingTop:t.padding,paddingBottom:t.padding}),B(t,le),["paddingLeft","paddingRight","paddingTop","paddingBottom"].forEach(a=>{t[a]=Number(t[a])}),Object.prototype.hasOwnProperty.call(t,"width")&&(t._prevWidth=t.width),Object.prototype.hasOwnProperty.call(t,"height")&&(t._prevHeight=t.height)}),r.edges().forEach(function(e){var t=r.edge(e);Object.prototype.hasOwnProperty.call(t,"label")||(t.label=""),B(t,de)})}function he(r){r.nodes().forEach(e=>{var t=r.node(e);Object.prototype.hasOwnProperty.call(t,"_prevWidth")?t.width=t._prevWidth:delete t.width,Object.prototype.hasOwnProperty.call(t,"_prevHeight")?t.height=t._prevHeight:delete t.height,delete t._prevWidth,delete t._prevHeight})}function E(r,e){var t=r.select("g."+e);return t.empty()&&(t=r.append("g").attr("class",e)),t}function ot(r,e,t){const a=e.width,n=e.height,i=(a+n)*.9,o=[{x:i/2,y:0},{x:i,y:-i/2},{x:i/2,y:-i},{x:0,y:-i/2}],s=M(r,i,i,o);return t.intersect=function(d){return O(t,o,d)},s}function st(r,e,t){const a=e.height,n=a/4,i=e.width+2*n,o=[{x:n,y:0},{x:i-n,y:0},{x:i,y:-a/2},{x:i-n,y:-a},{x:n,y:-a},{x:0,y:-a/2}],s=M(r,i,a,o);return t.intersect=function(d){return O(t,o,d)},s}function lt(r,e,t){const a=e.width,n=e.height,i=[{x:-n/2,y:0},{x:a,y:0},{x:a,y:-n},{x:-n/2,y:-n},{x:0,y:-n/2}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function dt(r,e,t){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:n/6,y:-n}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function ct(r,e,t){const a=e.width,n=e.height,i=[{x:2*n/6,y:0},{x:a+n/6,y:0},{x:a-2*n/6,y:-n},{x:-n/6,y:-n}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function ht(r,e,t){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a+2*n/6,y:0},{x:a-n/6,y:-n},{x:n/6,y:-n}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function ut(r,e,t){const a=e.width,n=e.height,i=[{x:n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:-2*n/6,y:-n}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function pt(r,e,t){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a+n/2,y:0},{x:a,y:-n/2},{x:a+n/2,y:-n},{x:0,y:-n}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function ft(r,e,t){const a=e.height,n=e.width+a/4,i=r.insert("rect",":first-child").attr("rx",a/2).attr("ry",a/2).attr("x",-n/2).attr("y",-a/2).attr("width",n).attr("height",a);return t.intersect=function(o){return G(t,o)},i}function gt(r,e,t){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a,y:0},{x:a,y:-n},{x:0,y:-n},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-n},{x:-8,y:-n},{x:-8,y:0}],o=M(r,a,n,i);return t.intersect=function(s){return O(t,i,s)},o}function yt(r,e,t){const a=e.width,n=a/2,i=n/(2.5+a/50),o=e.height+i,s="M 0,"+i+" a "+n+","+i+" 0,0,0 "+a+" 0 a "+n+","+i+" 0,0,0 "+-a+" 0 l 0,"+o+" a "+n+","+i+" 0,0,0 "+a+" 0 l 0,"+-o,d=r.attr("label-offset-y",i).insert("path",":first-child").attr("d",s).attr("transform","translate("+-a/2+","+-(o/2+i)+")");return t.intersect=function(u){const l=G(t,u),g=l.x-t.x;if(n!=0&&(Math.abs(g)<t.width/2||Math.abs(g)==t.width/2&&Math.abs(l.y-t.y)>t.height/2-i)){let c=i*i*(1-g*g/(n*n));c!=0&&(c=Math.sqrt(c)),c=i-c,u.y-t.y>0&&(c=-c),l.y+=c}return l},d}function ue(r){r.shapes().question=ot,r.shapes().hexagon=st,r.shapes().stadium=ft,r.shapes().subroutine=gt,r.shapes().cylinder=yt,r.shapes().rect_left_inv_arrow=lt,r.shapes().lean_right=dt,r.shapes().lean_left=ct,r.shapes().trapezoid=ht,r.shapes().inv_trapezoid=ut,r.shapes().rect_right_inv_arrow=pt}function pe(r){r({question:ot}),r({hexagon:st}),r({stadium:ft}),r({subroutine:gt}),r({cylinder:yt}),r({rect_left_inv_arrow:lt}),r({lean_right:dt}),r({lean_left:ct}),r({trapezoid:ht}),r({inv_trapezoid:ut}),r({rect_right_inv_arrow:pt})}function M(r,e,t,a){return r.insert("polygon",":first-child").attr("points",a.map(function(n){return n.x+","+n.y}).join(" ")).attr("transform","translate("+-e/2+","+t/2+")")}const fe={addToRender:ue,addToRenderV2:pe},wt={},ge=function(r){const e=Object.keys(r);for(const t of e)wt[t]=r[t]},bt=async function(r,e,t,a,n,i){const o=a?a.select(`[id="${t}"]`):x(`[id="${t}"]`),s=n||document,d=Object.keys(r);for(const u of d){const l=r[u];let g="default";l.classes.length>0&&(g=l.classes.join(" "));const c=W(l.styles);let h=l.text!==void 0?l.text:l.id,f;if(J(D().flowchart.htmlLabels)){const w={label:await K(h.replace(/fa[blrs]?:fa-[\w-]+/g,k=>`<i class='${k.replace(":"," ")}'></i>`),D())};f=tt(o,w).node(),f.parentNode.removeChild(f)}else{const w=s.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("style",c.labelStyle.replace("color:","fill:"));const k=h.split(Z.lineBreakRegex);for(const T of k){const S=s.createElementNS("http://www.w3.org/2000/svg","tspan");S.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),S.setAttribute("dy","1em"),S.setAttribute("x","1"),S.textContent=T,w.appendChild(S)}f=w}let b=0,p="";switch(l.type){case"round":b=5,p="rect";break;case"square":p="rect";break;case"diamond":p="question";break;case"hexagon":p="hexagon";break;case"odd":p="rect_left_inv_arrow";break;case"lean_right":p="lean_right";break;case"lean_left":p="lean_left";break;case"trapezoid":p="trapezoid";break;case"inv_trapezoid":p="inv_trapezoid";break;case"odd_right":p="rect_left_inv_arrow";break;case"circle":p="circle";break;case"ellipse":p="ellipse";break;case"stadium":p="stadium";break;case"subroutine":p="subroutine";break;case"cylinder":p="cylinder";break;case"group":p="rect";break;default:p="rect"}j.warn("Adding node",l.id,l.domId),e.setNode(i.db.lookUpDomId(l.id),{labelType:"svg",labelStyle:c.labelStyle,shape:p,label:f,rx:b,ry:b,class:g,style:c.style,id:i.db.lookUpDomId(l.id)})}},xt=async function(r,e,t){let a=0,n,i;if(r.defaultStyle!==void 0){const o=W(r.defaultStyle);n=o.style,i=o.labelStyle}for(const o of r){a++;const s="L-"+o.start+"-"+o.end,d="LS-"+o.start,u="LE-"+o.end,l={};o.type==="arrow_open"?l.arrowhead="none":l.arrowhead="normal";let g="",c="";if(o.style!==void 0){const h=W(o.style);g=h.style,c=h.labelStyle}else switch(o.stroke){case"normal":g="fill:none",n!==void 0&&(g=n),i!==void 0&&(c=i);break;case"dotted":g="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":g=" stroke-width: 3.5px;fill:none";break}l.style=g,l.labelStyle=c,o.interpolate!==void 0?l.curve=U(o.interpolate,$):r.defaultInterpolate!==void 0?l.curve=U(r.defaultInterpolate,$):l.curve=U(wt.curve,$),o.text===void 0?o.style!==void 0&&(l.arrowheadStyle="fill: #333"):(l.arrowheadStyle="fill: #333",l.labelpos="c",J(D().flowchart.htmlLabels)?(l.labelType="html",l.label=`<span id="L-${s}" class="edgeLabel L-${d}' L-${u}" style="${l.labelStyle}">${await K(o.text.replace(/fa[blrs]?:fa-[\w-]+/g,h=>`<i class='${h.replace(":"," ")}'></i>`),D())}</span>`):(l.labelType="text",l.label=o.text.replace(Z.lineBreakRegex,`
`),o.style===void 0&&(l.style=l.style||"stroke: #333; stroke-width: 1.5px;fill:none"),l.labelStyle=l.labelStyle.replace("color:","fill:"))),l.id=s,l.class=d+" "+u,l.minlen=o.length||1,e.setEdge(t.db.lookUpDomId(o.start),t.db.lookUpDomId(o.end),l,a)}},ye=function(r,e){return j.info("Extracting classes"),e.db.getClasses()},we=async function(r,e,t,a){j.info("Drawing flowchart");const{securityLevel:n,flowchart:i}=D();let o;n==="sandbox"&&(o=x("#i"+e));const s=n==="sandbox"?x(o.nodes()[0].contentDocument.body):x("body"),d=n==="sandbox"?o.nodes()[0].contentDocument:document;let u=a.db.getDirection();u===void 0&&(u="TD");const l=i.nodeSpacing||50,g=i.rankSpacing||50,c=new kt({multigraph:!0,compound:!0}).setGraph({rankdir:u,nodesep:l,ranksep:g,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});let h;const f=a.db.getSubGraphs();for(let y=f.length-1;y>=0;y--)h=f[y],a.db.addVertex(h.id,h.title,"group",void 0,h.classes);const b=a.db.getVertices();j.warn("Get vertices",b);const p=a.db.getEdges();let w=0;for(w=f.length-1;w>=0;w--){h=f[w],Tt("cluster").append("text");for(let y=0;y<h.nodes.length;y++)j.warn("Setting subgraph",h.nodes[y],a.db.lookUpDomId(h.nodes[y]),a.db.lookUpDomId(h.id)),c.setParent(a.db.lookUpDomId(h.nodes[y]),a.db.lookUpDomId(h.id))}await bt(b,c,e,s,d,a),await xt(p,c,a);const k=new se;fe.addToRender(k),k.arrows().none=function(y,v,_,m){const I=y.append("marker").attr("id",v).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 0 0 L 0 0 z");A(I,_[m+"Style"])},k.arrows().normal=function(y,v){y.append("marker").attr("id",v).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowheadPath").style("stroke-width",1).style("stroke-dasharray","1,0")};const T=s.select(`[id="${e}"]`),S=s.select("#"+e+" g");for(k(S,c),S.selectAll("g.node").attr("title",function(){return a.db.getTooltip(this.id)}),a.db.indexNodes("subGraph"+w),w=0;w<f.length;w++)if(h=f[w],h.title!=="undefined"){const y=d.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(h.id)+'"] rect'),v=d.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(h.id)+'"]'),_=y[0].x.baseVal.value,m=y[0].y.baseVal.value,I=y[0].width.baseVal.value,N=x(v[0]).select(".label");N.attr("transform",`translate(${_+I/2}, ${m+14})`),N.attr("id",e+"Text");for(let P=0;P<h.classes.length;P++)v[0].classList.add(h.classes[P])}if(!i.htmlLabels){const y=d.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const v of y){const _=v.getBBox(),m=d.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("rx",0),m.setAttribute("ry",0),m.setAttribute("width",_.width),m.setAttribute("height",_.height),v.insertBefore(m,v.firstChild)}}mt(c,T,i.diagramPadding,i.useMaxWidth),Object.keys(b).forEach(function(y){const v=b[y];if(v.link){const _=s.select("#"+e+' [id="'+a.db.lookUpDomId(y)+'"]');if(_){const m=d.createElementNS("http://www.w3.org/2000/svg","a");m.setAttributeNS("http://www.w3.org/2000/svg","class",v.classes.join(" ")),m.setAttributeNS("http://www.w3.org/2000/svg","href",v.link),m.setAttributeNS("http://www.w3.org/2000/svg","rel","noopener"),n==="sandbox"?m.setAttributeNS("http://www.w3.org/2000/svg","target","_top"):v.linkTarget&&m.setAttributeNS("http://www.w3.org/2000/svg","target",v.linkTarget);const I=_.insert(function(){return m},":first-child"),N=_.select(".label-container");N&&I.append(function(){return N.node()});const P=_.select(".label");P&&I.append(function(){return P.node()})}}})},be={setConf:ge,addVertices:bt,addEdges:xt,getClasses:ye,draw:we},Be={parser:vt,db:C,renderer:Mt,styles:At,init:r=>{r.flowchart||(r.flowchart={}),r.flowchart.arrowMarkerAbsolute=r.arrowMarkerAbsolute,be.setConf(r.flowchart),C.clear(),C.setGen("gen-1")}};export{Be as diagram};
